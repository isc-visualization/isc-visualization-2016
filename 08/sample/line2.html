<!DOCTYPE html>
<html lang="kr">

<head>
    <meta charset="utf-8">
    <title>D3 페이지 템플릿</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <style>
    .hover {
      fill-opacity: .4;
      transition : fill-opacity 2s;
    }
    </style>
</head>

<body>
</svg>
    <script type="text/javascript">
    d3.json('https://raw.githubusercontent.com/itct-visualization/itct-visualization-2016/master/08/sample/sample.line.json',
  draw);

  function draw(err, dataset) {
    var w = 400, h = 300;
    var margin = {top:10, right:40, bottom: 20, left: 20};
    var innerW = w - margin.right - margin.left,
      innerH = h - margin.top - margin.bottom;

    var svg = d3.select('body').append('svg')
        .attr('width', w)
        .attr('height', h)
      .append('g')
        .attr('transform', 'translate('+ [margin.left, margin.top] + ')');
    svg.append('clipPath')
      .attr('id', 'bar-clip')
    .append('rect')
      .attr('width', innerW)
      .attr('height', innerH)

    var nest = d3.nest()
      .key(function(d){return d.c})
      .sortKeys(d3.ascending)
      .sortValues(function(a,b){return a.x - b.x})
      .entries(dataset);

    var x = d3.scalePoint().domain(d3.range(1, 21))
      .range([0, innerW]);
    var y = d3.scaleLinear().domain([0, 100]).range([innerH, 0]);
    var c = d3.scaleOrdinal().domain(nest.map(function(d){return d.key}))
      .range(d3.schemeCategory10);

    var line = d3.line()
    .x(function(d){return x(d.x);})
    .y(function(d){return y(d.y);});


    var series = svg.selectAll('.series')
      .data(nest, function(d){return d.key})
      .enter().append('g')
        .style('stroke', function(d){return c(d.key)})
        .style('fill', function(d){return c(d.key)})
        .attr('clip-path', 'url(#bar-clip)')
        .attr('class', 'series');
    series.append('path')
      .datum(function(d) { return d.values})
      .style('fill', 'none')
      .attr('d', line);

    var point = series.selectAll('circle')
      .data(function(d){return d.values}, function(d){return d.x})
      .enter().append('circle')
      .style('cursor', 'pointer')
      .attr('cx', function(d){return x(d.x)})
      .attr('cy', function(d){return y(d.y)})
      .attr('r', 4);

      point.on('mouseenter', function(d) {
        var hover = point.filter(function(p) {return d.x === p.x})
          .classed('hover', true);
        var tooltip = svg.selectAll('.tooltip')
          .data(hover.data())
        tooltip.enter().append('text')
            .attr('class', 'tooltip')
            .style('opacity', 0)
            .merge(tooltip)
            .attr('x', function(d){return x(d.x)})
            .attr('dx', '.35em')
            .attr('y', function(d){return y(d.y)})
            .style('fill', function(d){return c(d.c)})
            .text(function(d){return d.y})
            .transition()
            .style('opacity', 1)
      }).on('mouseleave', function() {
        var hover = point.filter(function() {
          return d3.select(this).classed('hover')
        }).classed('hover', false);
        svg.selectAll('.tooltip')
          .transition()
          .style('opacity', 0)
      })
      var chipHeight = 12;
  var chipPadding = 2;
  var legendHeight = 16;
  var legendPadding = 4;

  var legend = svg.selectAll('.legend')
   .data(c.domain())
     .enter().append('g')
     .attr('class', 'legend')
     .attr('transform', function(d,i){
       return 'translate(' + [innerW + legendHeight, legendHeight + i *(legendHeight + legendPadding)]+ ')'
     })

     legend.append('rect')
        .attr('y', chipPadding)
        .attr('width', chipHeight).attr('height', chipHeight)
        .style('fill', function(d){return c(d)});

    legend.append('text')
     .attr('x', chipPadding+ chipHeight)
     .attr('y', chipPadding)
     .attr('dy', '.71em')
     .style('font-size', (legendHeight-2)+ 'px')
     .style('font-family', 'sans-serif')
     .text(function(d){return d})
    /*
    svg.selectAll('path')
      .data(nest.map(function(d){return d.values}))
      .enter().append('path')
      .style('stroke', function(d){return c(d[0].c)})
      .style('fill', 'none')
      .attr('d', line)
    */
  }



    </script>
</body>

</html>
